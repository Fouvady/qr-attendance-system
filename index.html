<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fouvady // Quantum Attendance</title>
    
    <!-- FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Load JSQR & QRCode Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        /* 
         * =========================================
         * THEME & VARIABLES
         * =========================================
         */
        :root {
            --primary-pink: #ff00cc;
            --primary-purple: #9d00ff;
            --deep-purple: #1a0033;
            --glass-border: rgba(255, 0, 204, 0.25);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --neon-gradient: linear-gradient(135deg, #ff00cc, #bf00ff, #00d2ff);
            --status-color: #00ffaa; 
            
            /* Fonts */
            --font-ui: 'Montserrat', sans-serif;
            --font-mono: 'Roboto Mono', monospace;
            --font-sig: 'Great Vibes', cursive;
            
            /* USER PROVIDED BACKGROUND URL */
            --bg-image-url: url('https://z-cdn-media.chatglm.cn/files/3901d8ee-956e-4dd4-b71b-0f7af5ca836d.png?auth_key=1872013312-58f3a3b6043849d2aab6846e8de865e1-0-f9bab2ef80a912e6a0f9eece437d3731');
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            cursor: none; /* Default to custom cursor */
            background-color: #050005;
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            font-family: var(--font-ui); 
            transform: translate3d(0,0,0);
        }

        /* 
         * =========================================
         * BACKGROUND (STATIC LAYERS)
         * =========================================
         */
        
        /* 1. Static Base Image */
        .bg-base {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: var(--bg-image-url) center/cover no-repeat;
            z-index: -3;
            filter: contrast(1.1) saturate(1.2);
        }

        /* 2. Static Layer 1 (Blur) */
        .bg-layer-1 {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: var(--bg-image-url) center/cover no-repeat;
            z-index: -2;
            filter: blur(15px) hue-rotate(-10deg) contrast(1.1);
            opacity: 0.7; 
            mix-blend-mode: screen;
        }

        /* 3. Static Layer 2 (Color Shift) */
        .bg-layer-2 {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: var(--bg-image-url) center/cover no-repeat;
            z-index: -1;
            filter: blur(50px) hue-rotate(30deg) brightness(1.4) saturate(1.8);
            opacity: 0.5; 
            mix-blend-mode: color-dodge;
        }

        /* 4. The Animated Energy Canvas */
        #energyCanvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1; 
            pointer-events: none;
            mix-blend-mode: screen;
        }

        .bg-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.85) 100%);
            backdrop-filter: blur(2px); z-index: 0; pointer-events: none;
        }

        /* 
         * =========================================
         * CUSTOM CURSOR
         * =========================================
         */
        @media (hover: none) {
            body { cursor: auto; }
            .cursor-dot, .cursor-ring { display: none !important; }
        }
        .cursor-dot, .cursor-ring {
            position: fixed; top: 0; left: 0;
            transform: translate3d(-50%, -50%, 0); border-radius: 50%;
            z-index: 99999; pointer-events: none; will-change: transform;
        }
        .cursor-dot {
            width: 8px; height: 8px; background-color: #fff;
            box-shadow: 0 0 10px #fff, 0 0 20px var(--primary-pink), 0 0 40px var(--primary-purple);
        }
        .cursor-ring {
            width: 40px; height: 40px; border: 2px solid var(--primary-pink);
            box-shadow: 0 0 15px var(--primary-pink), 0 0 30px var(--primary-purple), inset 0 0 10px var(--primary-pink);
            transition: width 0.15s, height 0.15s, background-color 0.2s; opacity: 0.9;
        }
        body.hovering .cursor-ring {
            width: 60px; height: 60px; border-color: #fff;
            background-color: rgba(255, 0, 204, 0.15);
            box-shadow: 0 0 25px var(--primary-pink), 0 0 50px var(--primary-purple);
            mix-blend-mode: screen;
        }

        /* 
         * =========================================
         * GLASS PANEL (FIXED OVERFLOW)
         * =========================================
         */
        .glass-panel {
            background: rgba(20, 0, 30, 0.65);
            backdrop-filter: blur(20px) saturate(150%); -webkit-backdrop-filter: blur(20px) saturate(150%);
            border: 1px solid var(--glass-border); 
            border-radius: 24px; padding: 24px;
            width: 100%; max-width: 500px; 
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.6), inset 0 0 10px rgba(255,255,255,0.05);
            position: relative; 
            overflow: hidden; 
            min-height: fit-content; 
            transition: transform 0.3s;
            margin-bottom: 20px;
        }

        /* THE EDGE LIGHT BORDER ANIMATION */
        .glass-panel::after {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: 24px;
            padding: 1.5px; 
            background: linear-gradient(90deg, transparent, #ff00cc, #ffffff, #9d00ff, transparent);
            background-size: 300% 300%;
            -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            animation: borderFlow 6s linear infinite;
            pointer-events: none;
            opacity: 0.8;
            z-index: 1;
        }

        @keyframes borderFlow {
            0% { background-position: 0% 50% }
            100% { background-position: 300% 50% }
        }

        /* 
         * =========================================
         * UI ELEMENTS
         * =========================================
         */
        .input-group { margin-bottom: 20px; position: relative; z-index: 2; }
        
        label { 
            display: block; 
            font-size: 0.75rem; 
            color: var(--text-secondary); 
            margin-bottom: 8px; 
            margin-left: 4px; 
            text-transform: uppercase; 
            letter-spacing: 1.5px; 
            font-weight: 600; 
            z-index: 2;
            position: relative;
        }

        input {
            width: 100%; 
            background: rgba(0,0,0,0.4); 
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 12px; 
            padding: 16px; 
            color: #fff; 
            font-family: var(--font-ui); 
            font-size: 1rem; 
            font-weight: 400;
            outline: none; 
            transition: border-color 0.3s, box-shadow 0.3s, background 0.3s;
            position: relative; z-index: 2;
        }

        input::placeholder {
            color: rgba(255,255,255,0.4);
            font-weight: 400;
        }

        input:focus {
            border-color: var(--primary-pink);
            box-shadow: 0 0 15px rgba(255, 0, 204, 0.2); 
            background: rgba(0,0,0,0.6); 
        }

        /* Verification Loader */
        #verify-loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95); backdrop-filter: blur(30px);
            z-index: 2000; display: none; justify-content: center; align-items: center; flex-direction: column; animation: fadeIn 0.3s ease;
        }
        .blue-device {
            width: 300px; height: 300px; background: linear-gradient(145deg, #00d2ff, #3a7bd5);
            border-radius: 40px; display: flex; flex-direction: column; justify-content: center; align-items: center;
            box-shadow: 0 30px 60px rgba(0, 210, 255, 0.4), inset 0 0 0 2px rgba(255, 255, 255, 0.3);
            position: relative; overflow: hidden; transform: scale(0.8); animation: devicePop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        .blue-device::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.4) 0%, transparent 50%);
            border-radius: 40px; pointer-events: none;
        }
        .device-icon {
            width: 90px; height: 90px; background: #fff; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; margin-bottom: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3); color: #3a7bd5; font-size: 2.5rem; position: relative; z-index: 2;
        }
        .check-badge {
            position: absolute; bottom: -5px; right: -5px; width: 35px; height: 35px;
            background: #2ecc71; color: white; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; font-size: 1.2rem;
            border: 4px solid #fff; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transform: scale(0); animation: badgePop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) 1.2s forwards; z-index: 3;
        }
        .device-text {
            color: #fff; font-family: var(--font-ui); font-weight: 700; font-size: 1.4rem;
            text-transform: uppercase; letter-spacing: 2px; opacity: 0; animation: textFade 0.6s ease 1s forwards; z-index: 2;
        }
        .scanning-laser {
            position: absolute; width: 100%; height: 6px;
            background: rgba(255, 255, 255, 0.9); box-shadow: 0 0 20px #fff, 0 0 40px #00d2ff; top: 0;
            animation: scanDevice 1.8s ease-in-out infinite; z-index: 1;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes devicePop { to { transform: scale(1); } }
        @keyframes badgePop { to { transform: scale(1); } }
        @keyframes textFade { to { opacity: 1; } }
        @keyframes scanDevice { 0% { top: -10%; opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { top: 110%; opacity: 0; } }

        /* Intro Loader */
        #loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; justify-content: center; align-items: center;
            transition: transform 1.4s cubic-bezier(0.6, -0.28, 0.735, 0.045), opacity 1s ease-in;
        }
        #loading-screen.hide { transform: scale(1.6); opacity: 0; pointer-events: none; }
        
        .loader-svg-container { width: 100%; max-width: 600px; filter: drop-shadow(0 0 15px rgba(255, 0, 204, 0.6)); }
        .sig-text {
            fill: transparent; stroke: url(#textGradient); stroke-width: 2;
            stroke-dasharray: 2000; stroke-dashoffset: 2000;
            font-family: var(--font-sig); font-size: 140px;
            animation: writeName 3.5s cubic-bezier(0.37, 0, 0.63, 1) forwards,
                       fillName 1.5s ease-out 2.5s forwards,
                       neonPulse 2s infinite alternate 3s;
            will-change: stroke-dashoffset, fill, filter;
        }
        @keyframes writeName { to { stroke-dashoffset: 0; } }
        @keyframes fillName { from { fill: transparent; } to { fill: url(#textGradient); } }
        @keyframes neonPulse {
            from { filter: drop-shadow(0 0 5px #ff00cc) drop-shadow(0 0 10px #8e2de2); }
            to { filter: drop-shadow(0 0 20px #ff00cc) drop-shadow(0 0 40px #8e2de2) drop-shadow(0 0 80px #fff); }
        }

        #app-container {
            opacity: 0; transition: opacity 1.2s ease 1s;
            width: 100%; height: 100%; display: flex; flex-direction: column;
            position: relative; z-index: 1; will-change: opacity;
        }
        #app-container.visible { opacity: 1; }

        /* Header & Nav */
        header {
            padding: 15px 25px; display: flex; justify-content: space-between; align-items: center;
            backdrop-filter: blur(20px); background: rgba(0,0,0,0.3);
            border-bottom: 1px solid var(--glass-border); z-index: 10;
            flex-shrink: 0;
        }
        
        h1 { 
            font-weight: 700; 
            font-size: 1.2rem; 
            letter-spacing: 1px; 
            background: var(--neon-gradient); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
        }

        .status-badge {
            display: flex; align-items: center; gap: 8px;
            background: rgba(0, 255, 170, 0.1);
            border: 1px solid rgba(0, 255, 170, 0.3);
            padding: 6px 14px;
            border-radius: 20px; 
            backdrop-filter: blur(10px);
            box-shadow: 0 0 15px rgba(0, 255, 170, 0.1);
        }
        .status-dot {
            width: 8px; height: 8px; background: var(--status-color);
            border-radius: 50%; box-shadow: 0 0 10px var(--status-color);
            animation: statusPulse 2s infinite ease-in-out;
        }
        .status-text {
            font-family: var(--font-ui);
            font-size: 0.75rem;
            color: var(--status-color);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 700; 
        }
        @keyframes statusPulse {
            0% { opacity: 0.6; transform: scale(0.9); box-shadow: 0 0 5px var(--status-color); }
            50% { opacity: 1; transform: scale(1.2); box-shadow: 0 0 15px var(--status-color), 0 0 25px var(--status-color); }
            100% { opacity: 0.6; transform: scale(0.9); box-shadow: 0 0 5px var(--status-color); }
        }

        .nav-tabs { display: flex; gap: 12px; padding: 15px 25px; justify-content: center; background: rgba(0,0,0,0.1); backdrop-filter: blur(10px); flex-shrink: 0; }
        .tab-btn {
            background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-secondary); padding: 12px 28px; border-radius: 30px; 
            cursor: pointer; transition: all 0.3s; font-family: var(--font-ui); font-weight: 600; font-size: 0.9rem;
            backdrop-filter: blur(10px); position: relative; overflow: hidden;
            letter-spacing: 0.5px;
        }
        .tab-btn.active {
            background: rgba(255, 0, 204, 0.15); border-color: var(--primary-pink);
            color: #fff; box-shadow: 0 0 20px rgba(255, 0, 204, 0.2); 
            font-weight: 700; 
        }

        main { flex: 1; position: relative; overflow: hidden; }
        .view-section {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            padding: 20px; overflow-y: auto; display: none; flex-direction: column;
            align-items: center; gap: 20px; opacity: 0; transform: scale(0.95);
            transition: all 0.4s; scrollbar-width: none;
            scroll-behavior: smooth;
        }
        .view-section::-webkit-scrollbar { display: none; }
        .view-section.active-view { display: flex; opacity: 1; transform: scale(1); }

        h2 { 
            text-align: center; 
            font-weight: 600; 
            margin-bottom: 20px; 
            font-size: 1.5rem; 
            letter-spacing: 0.5px; 
            color: #fff;
        }

        .btn {
            width: 100%; padding: 16px; border: none; border-radius: 12px; 
            font-family: var(--font-ui); font-weight: 600; font-size: 1rem;
            cursor: pointer; transition: all 0.2s;
            letter-spacing: 0.5px;
            position: relative; z-index: 2;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--deep-purple), var(--primary-pink));
            color: white; box-shadow: 0 5px 20px rgba(255, 0, 204, 0.4);
        }
        .btn-primary:active { transform: scale(0.97); }
        .btn-secondary { background: rgba(255,255,255,0.05); color: var(--text-secondary); border: 1px solid rgba(255,255,255,0.1); }

        /* RESULT CARD - FIXED LAYOUT */
        #qr-result-card { 
            display: none; 
            text-align: center; 
            animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            margin-top: 20px;
            width: 100%;
        }
        
        #qrcode {
            background: #fff; padding: 20px; border-radius: 20px;
            width: fit-content; margin: 0 auto 20px auto; 
            box-shadow: 0 0 40px rgba(255, 0, 204, 0.4);
            border: 2px solid rgba(255,255,255,0.8);
            display: inline-block;
        }
        #qrcode img { display: block; }
        
        /* 
         * =========================================
         * UNIQUE CODE BOX - MAXIMUM VISIBILITY
         * =========================================
         */
        .code-label {
            margin-top: 20px; 
            margin-bottom: 15px; 
            display: block;
            font-size: 0.9rem; 
            color: #fff; 
            text-transform: uppercase; 
            font-weight: 700; 
            letter-spacing: 1.5px;
            text-shadow: 0 0 10px var(--primary-pink);
            z-index: 10;
            position: relative;
        }

        #unique-code-display {
            background: #000000; 
            border: 2px solid var(--primary-pink); 
            color: #ffffff; 
            font-family: var(--font-mono), monospace; 
            font-weight: 700; 
            font-size: 1.3rem; 
            text-align: center;
            padding: 20px 15px; 
            border-radius: 12px; 
            letter-spacing: 1px; 
            margin-top: 10px; 
            margin-bottom: 20px;
            word-break: break-all; 
            cursor: pointer; 
            box-shadow: 0 0 30px rgba(255, 0, 204, 0.5), inset 0 0 20px rgba(255, 0, 204, 0.2); 
            user-select: all;
            position: relative;
            z-index: 50; 
            line-height: 1.5;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.8), 0 0 10px var(--primary-pink);
            transition: transform 0.1s, background 0.2s;
        }

        #unique-code-display:active {
            background: #1a1a1a;
            transform: scale(0.98);
            box-shadow: 0 0 40px rgba(255, 0, 204, 0.8), inset 0 0 10px rgba(255, 0, 204, 0.4);
        }
        
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* SCANNER UI */
        .scanner-wrapper {
            position: relative; width: 100%; aspect-ratio: 1/1; background: #000;
            border-radius: 24px; overflow: hidden; border: 2px solid var(--glass-border);
            box-shadow: inset 0 0 40px rgba(0,0,0,0.9), 0 0 30px rgba(255,0,204,0.1);
        }
        #video-preview { width: 100%; height: 100%; object-fit: cover; opacity: 0.9; }
        .scan-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            border: 60px solid rgba(0,0,0,0.7); box-sizing: border-box;
            display: flex; justify-content: center; align-items: center;
            background: radial-gradient(circle, transparent 40%, rgba(0,0,0,0.8) 100%);
        }
        .scan-line {
            width: 80%; height: 3px; background: var(--primary-pink);
            box-shadow: 0 0 20px var(--primary-pink), 0 0 40px #fff, 0 0 60px var(--primary-purple);
            animation: scanPurple 2s infinite ease-in-out; border-radius: 2px;
        }
        @keyframes scanPurple {
            0% { transform: translateY(-200px) scaleY(1); opacity: 0; } 20% { opacity: 1; }
            80% { opacity: 1; } 100% { transform: translateY(200px) scaleY(1); opacity: 0; }
        }

        .manual-entry { display: flex; gap: 12px; width: 100%; }
        .manual-entry input { flex: 1; }
        .manual-entry button { width: auto; padding: 0 30px; }

        .list-container { width: 100%; max-width: 500px; flex: 1; overflow-y: auto; padding-bottom: 30px; }
        .log-item {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px; 
            padding: 18px; margin-bottom: 15px; display: flex;
            justify-content: space-between; align-items: center; transition: all 0.3s;
            backdrop-filter: blur(5px);
        }
        .log-item:hover { background: rgba(255,255,255,0.1); border-color: var(--primary-pink); transform: translateX(5px); }
        .log-details h4 { 
            font-size: 1.1rem; margin-bottom: 5px; color: #fff; font-weight: 600; 
        }
        .log-details p { font-size: 0.85rem; color: var(--text-secondary); font-weight: 400; }
        .log-time { 
            font-family: var(--font-mono); 
            font-size: 0.75rem; 
            color: var(--primary-pink); 
            text-align: right; 
            font-weight: 500; 
            letter-spacing: 0.5px;
            line-height: 1.4;
        }

        /* 
         * =========================================
         * TOAST NOTIFICATION (CENTERED)
         * =========================================
         */
        #toast {
            position: fixed; 
            top: 50%; 
            left: 50%; 
            /* Start centered but slightly scaled down and invisible for animation */
            transform: translate(-50%, -50%) scale(0.9); 
            opacity: 0;
            
            background: rgba(20, 0, 10, 0.95); 
            backdrop-filter: blur(30px); 
            
            padding: 20px 40px;
            border-radius: 50px; 
            border: 1px solid var(--primary-pink);
            
            box-shadow: 0 25px 50px rgba(255, 0, 204, 0.4); 
            display: flex; 
            align-items: center; 
            gap: 12px;
            
            z-index: 10000; /* High z-index to be on top of everything */
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            
            white-space: nowrap;
            will-change: transform, opacity;
            pointer-events: none; /* Let clicks pass through if needed */
        }

        #toast.visible {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1); /* Pop to normal size */
        }
    </style>
</head>
<body>

    <!-- BACKGROUND LAYERS -->
    <div class="bg-base"></div>
    <div class="bg-layer-1"></div>
    <div class="bg-layer-2"></div>
    
    <!-- ANIMATED ENERGY CANVAS -->
    <canvas id="energyCanvas"></canvas>
    
    <div class="bg-overlay"></div>

    <!-- CURSOR -->
    <div class="cursor-dot"></div>
    <div class="cursor-ring"></div>

    <!-- INITIAL SIGNATURE LOADER -->
    <div id="loading-screen">
        <div class="loader-svg-container">
            <svg viewBox="0 0 600 200" class="loader-svg">
                <defs>
                    <linearGradient id="textGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#ff00cc;stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#ffffff;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#9d00ff;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <text x="50%" y="55%" text-anchor="middle" class="sig-text">Fouvady</text>
            </svg>
        </div>
    </div>

    <div id="verify-loader">
        <div class="blue-device">
            <div class="scanning-laser"></div>
            <div class="device-icon">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <div class="check-badge">✓</div>
            </div>
            <div class="device-text">Verified</div>
        </div>
        <p style="margin-top: 25px; color: #fff; font-family: var(--font-ui); letter-spacing: 2px; font-weight: 500; text-shadow: 0 0 10px #00d2ff;">PROCESSING BIOMETRICS...</p>
    </div>

    <div id="app-container">
        <header>
            <h1>QUANTUM ATTENDANCE</h1>
            
            <div class="status-badge">
                <div class="status-dot"></div>
                <span class="status-text">Server Live</span>
            </div>
        </header>

        <div class="nav-tabs">
            <button class="tab-btn active" onclick="switchTab('register')">Register</button>
            <button class="tab-btn" onclick="switchTab('scan')">Scan</button>
            <button class="tab-btn" onclick="switchTab('logs')">Logs</button>
        </div>

        <main>
            <!-- REGISTER SECTION -->
            <div id="view-register" class="view-section active-view">
                <div class="glass-panel">
                    <h2 style="color: var(--primary-pink); text-transform: uppercase; letter-spacing: 2px; font-weight: 700;">New Entry</h2>
                    <div class="input-group">
                        <label>Full Name</label>
                        <input type="text" id="reg-name" placeholder="Ex. John Doe" class="hover-trigger" autocomplete="off">
                    </div>
                    <div class="input-group">
                        <label>Course / Class</label>
                        <input type="text" id="reg-course" placeholder="Ex. Quantum Physics 101" class="hover-trigger" autocomplete="off">
                    </div>
                    <div class="input-group">
                        <label>Student ID</label>
                        <input type="text" id="reg-id" placeholder="Ex. S-2024-001" class="hover-trigger" autocomplete="off">
                    </div>
                    <button class="btn btn-primary hover-trigger" onclick="registerUser()">Generate Access Pass</button>
                </div>

                <div id="qr-result-card" class="glass-panel">
                    <h3 style="margin-bottom: 15px; font-weight: 600; letter-spacing: 1px; color:white;">Quantum ID Generated</h3>
                    
                    <!-- QR Code -->
                    <div id="qrcode"></div>
                    
                    <!-- LABEL -->
                    <span class="code-label">Backup Hash Key</span>
                    
                    <!-- THE VISIBLE CODE BOX -->
                    <div id="unique-code-display" onclick="copyCode()" title="Click to Copy">---</div>
                    <span class="helper-text" style="font-size: 0.75rem; color: rgba(255,255,255,0.5); margin-top: -10px; display: block;">(Tap code to copy)</span>
                </div>
                
                <!-- Spacer -->
                <div style="height: 50px;"></div>
            </div>

            <!-- SCAN SECTION -->
            <div id="view-scan" class="view-section">
                <div class="glass-panel" style="padding: 12px; max-width: 420px;">
                    <div class="scanner-wrapper">
                        <video id="video-preview" playsinline muted></video>
                        <canvas id="qr-canvas" style="display:none;"></canvas>
                        <div class="scan-overlay">
                            <div class="scan-line"></div>
                        </div>
                    </div>
                </div>

                <div class="glass-panel" style="max-width: 420px; padding: 20px;">
                    <p style="text-align: center; margin-bottom: 12px; font-size: 0.85rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; font-weight: 600;">Manual Override</p>
                    <div class="manual-entry">
                        <input type="text" id="manual-code" placeholder="Enter Hash Key" class="hover-trigger">
                        <button class="btn btn-primary hover-trigger" style="width: auto; padding: 0 30px;" onclick="processManualEntry()">Scan</button>
                    </div>
                </div>
                
                <button id="toggle-cam-btn" class="btn btn-secondary hover-trigger" style="max-width: 420px;" onclick="toggleCamera()">Initialize Optical Sensor</button>
            </div>

            <!-- LOGS SECTION -->
            <div id="view-logs" class="view-section">
                <div style="display: flex; justify-content: space-between; width: 100%; max-width: 500px; margin-bottom: 20px; align-items: center;">
                    <h2 style="margin:0; font-size: 1.3rem; color: var(--primary-purple); font-weight: 700;">System Logs</h2>
                    <button onclick="downloadLogs()" class="hover-trigger" style="background:none; border:none; color:var(--primary-pink); font-size:0.9rem; cursor:pointer; text-transform: uppercase; font-weight: 700; letter-spacing: 1px;">Export Data</button>
                </div>
                <div class="list-container" id="logs-list"></div>
            </div>
        </main>

        <!-- TOAST -->
        <div id="toast">
            <span id="toast-icon" style="color: #00ffaa; font-size: 1.5rem;">✓</span>
            <span id="toast-msg" style="font-weight: 700; font-size: 1.1rem; letter-spacing: 0.5px;">Success</span>
        </div>
    </div>

    <script>
        /* 
         * =========================================
         * 4K HDR ENERGY FLOW ENGINE (BACKGROUND)
         * =========================================
         */
        const energyCanvas = document.getElementById("energyCanvas");
        const eCtx = energyCanvas.getContext("2d");

        let w, h;
        function resizeEnergy() {
            w = energyCanvas.width = window.innerWidth;
            h = energyCanvas.height = window.innerHeight;
        }
        resizeEnergy();
        window.addEventListener("resize", resizeEnergy);

        /* ENERGY PARTICLES TRAVELING ALONG CURVES */
        const particles = [];
        const particleCount = 180;

        for (let i = 0; i < particleCount; i++) {
            particles.push({
                x: Math.random() * w,
                y: Math.random() * h,
                angle: Math.random() * Math.PI * 2,
                speed: .3 + Math.random() * .5,
                size: 1 + Math.random() * 2
            });
        }

        function drawEnergy() {
            eCtx.clearRect(0, 0, w, h);

            /* Additive glow blending */
            eCtx.globalCompositeOperation = "lighter";

            particles.forEach(p => {
                p.x += Math.cos(p.angle) * p.speed;
                p.y += Math.sin(p.angle) * p.speed;

                /* subtle curve distortion */
                p.angle += (Math.sin(p.y * .002) + Math.cos(p.x * .002)) * .01;

                /* wrap */
                if (p.x < 0) p.x = w;
                if (p.x > w) p.x = 0;
                if (p.y < 0) p.y = h;
                if (p.y > h) p.y = 0;

                /* gradient glow */
                const g = eCtx.createRadialGradient(p.x, p.y, 0, p.x, p.y, 30);
                g.addColorStop(0, "rgba(255,255,255,.9)");
                g.addColorStop(.3, "rgba(255,0,204,.7)");
                g.addColorStop(1, "rgba(157,0,255,0)");

                eCtx.fillStyle = g;
                eCtx.beginPath();
                eCtx.arc(p.x, p.y, 30, 0, Math.PI * 2);
                eCtx.fill();
            });

            /* Subtle pulse */
            eCtx.globalAlpha = .6 + .2 * Math.sin(Date.now() * .002);

            requestAnimationFrame(drawEnergy);
        }

        drawEnergy();


        /* 
         * =========================================
         * CURSOR LOGIC
         * =========================================
         */
        const cursorDot = document.querySelector('.cursor-dot');
        const cursorRing = document.querySelector('.cursor-ring');
        let mouseX = 0, mouseY = 0, ringX = 0, ringY = 0;

        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
            cursorDot.style.transform = `translate3d(${mouseX}px, ${mouseY}px, 0) translate(-50%, -50%)`;
        });

        function animateCursor() {
            ringX += (mouseX - ringX) * 0.2;
            ringY += (mouseY - ringY) * 0.2;
            cursorRing.style.transform = `translate3d(${ringX}px, ${ringY}px, 0) translate(-50%, -50%)`;
            requestAnimationFrame(animateCursor);
        }
        animateCursor();

        const hoverTriggers = document.querySelectorAll('.hover-trigger, button, a, input');
        hoverTriggers.forEach(el => {
            el.addEventListener('mouseenter', () => document.body.classList.add('hovering'));
            el.addEventListener('mouseleave', () => document.body.classList.remove('hovering'));
        });

        /* 
         * =========================================
         * INITIALIZATION
         * =========================================
         */
        document.fonts.ready.then(() => {
            setTimeout(() => {
                document.getElementById('loading-screen').classList.add('hide');
                document.getElementById('app-container').classList.add('visible');
                setTimeout(() => { document.getElementById('loading-screen').style.display = 'none'; }, 1400);
            }, 2800);
        });

        function showVerificationLoader(callback) {
            const loader = document.getElementById('verify-loader');
            loader.style.display = 'flex';
            setTimeout(() => {
                loader.style.display = 'none';
                callback();
            }, 2500);
        }

        /* 
         * =========================================
         * SYSTEM LOGIC
         * =========================================
         */
        const DB_USERS = 'attendance_users_db';
        const DB_LOGS = 'attendance_logs_db';
        let users = JSON.parse(localStorage.getItem(DB_USERS)) || [];
        let logs = JSON.parse(localStorage.getItem(DB_LOGS)) || [];
        let currentGeneratedCode = "";

        function switchTab(tabId) {
            if (tabId !== 'scan' && isScanning) stopCamera();
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active-view'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(`view-${tabId}`).classList.add('active-view');
            const buttons = document.querySelectorAll('.tab-btn');
            if(tabId === 'register') buttons[0].classList.add('active');
            if(tabId === 'scan') buttons[1].classList.add('active');
            if(tabId === 'logs') { buttons[2].classList.add('active'); renderLogs(); }
        }

        function generateUniqueCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let result = 'Q-';
            for (let i = 0; i < 4; i++) result += chars.charAt(Math.floor(Math.random() * chars.length));
            result += '-' + Date.now().toString().substr(-4);
            return result;
        }

        function copyCode() {
            if(!currentGeneratedCode) return;
            navigator.clipboard.writeText(currentGeneratedCode).then(() => {
                showToast("Code Copied to Clipboard!");
            }).catch(err => {
                showToast("Failed to copy", true);
            });
        }

        function registerUser() {
            const nameInput = document.getElementById('reg-name');
            const idInput = document.getElementById('reg-id');
            const courseInput = document.getElementById('reg-course');

            const name = nameInput.value.trim();
            const id = idInput.value.trim();
            const course = courseInput.value.trim();

            // 1. Basic Validation
            if (!name || !id) { 
                showToast("Name and ID are required", true); 
                return; 
            }

            // 2. Check for duplicates based on user requirements:
            // "Do NOT register again IF Full Name matches exactly AND ID/Code matches exactly"
            const isDuplicate = users.some(user => 
                user.name === name && user.studentId === id
            );

            if (isDuplicate) {
                // LOGIC: Name AND ID match -> Error
                showToast("User already registered", true);
                return; // Stop execution
            }

            // 3. If we are here, it is allowed:
            // Either new user, or same name different ID (which is allowed per requirements)
            
            const uniqueCode = generateUniqueCode();
            currentGeneratedCode = uniqueCode; // Store for copying
            
            const newUser = { 
                uniqueCode, 
                name, 
                course, 
                studentId: id || "N/A", 
                registeredAt: new Date().toISOString() 
            };
            
            users.push(newUser);
            localStorage.setItem(DB_USERS, JSON.stringify(users));
            
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = "";
            
            // Reveal card first to ensure QR renders correctly
            const resultCard = document.getElementById('qr-result-card');
            resultCard.style.display = 'block';
            
            // Generate QR
            new QRCode(qrContainer, { text: uniqueCode, width: 180, height: 180, colorDark : "#2e004f", colorLight : "#ffffff", correctLevel : QRCode.CorrectLevel.H });
            
            // Set Text
            const codeDisplay = document.getElementById('unique-code-display');
            codeDisplay.innerText = uniqueCode;
            
            // SCROLL FIX
            setTimeout(() => {
                resultCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 350);

            showToast("Registered successfully");
        }

        const video = document.getElementById('video-preview');
        const scanCanvas = document.getElementById('qr-canvas');
        const scanCtx = scanCanvas.getContext('2d', { willReadFrequently: true });
        let isScanning = false, animationId = null, lastScanTime = 0;

        function toggleCamera() {
            if (isScanning) stopCamera(); else startCamera();
        }

        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                video.srcObject = stream;
                video.setAttribute("playsinline", true);
                video.play();
                isScanning = true;
                document.getElementById('toggle-cam-btn').innerText = "Terminate Sensor";
                document.getElementById('toggle-cam-btn').classList.add('btn-primary');
                document.getElementById('toggle-cam-btn').classList.remove('btn-secondary');
                requestAnimationFrame(tick);
            } catch (err) { showToast("Camera Access Denied", true); }
        }

        function stopCamera() {
            isScanning = false;
            if (video.srcObject) { video.srcObject.getTracks().forEach(t => t.stop()); video.srcObject = null; }
            document.getElementById('toggle-cam-btn').innerText = "Initialize Optical Sensor";
            document.getElementById('toggle-cam-btn').classList.add('btn-secondary');
            document.getElementById('toggle-cam-btn').classList.remove('btn-primary');
            if (animationId) cancelAnimationFrame(animationId);
        }

        function tick() {
            if (!isScanning) return;
            if (video.readyState === video.HAVE_ENOUGH_DATA) {
                scanCanvas.height = video.videoHeight;
                scanCanvas.width = video.videoWidth;
                scanCtx.drawImage(video, 0, 0, scanCanvas.width, scanCanvas.height);
                const imageData = scanCtx.getImageData(0, 0, scanCanvas.width, scanCanvas.height);
                const code = jsQR(imageData.data, imageData.width, imageData.height, { inversionAttempts: "dontInvert" });
                if (code) {
                    const now = Date.now();
                    if (now - lastScanTime > 2500) { lastScanTime = now; processScan(code.data); }
                }
            }
            animationId = requestAnimationFrame(tick);
        }

        function processScan(scannedCode) {
            const user = users.find(u => u.uniqueCode === scannedCode);
            if (user) {
                video.style.filter = "brightness(2) contrast(1.5)";
                setTimeout(() => video.style.filter = "brightness(1) contrast(1)", 100);
                showVerificationLoader(() => {
                    logAttendance(user);
                    showToast(`Welcome, ${user.name}`);
                });
            } else {
                showToast("Invalid Identity Hash", true);
            }
        }

        function processManualEntry() {
            const input = document.getElementById('manual-code').value.trim();
            if(!input) return;
            processScan(input);
            document.getElementById('manual-code').value = '';
        }

        function logAttendance(user) {
            logs.push({ userName: user.name, userCourse: user.course, userId: user.studentId, timestamp: Date.now(), dateStr: new Date().toLocaleString() });
            localStorage.setItem(DB_LOGS, JSON.stringify(logs));
            if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
        }

        function renderLogs() {
            const container = document.getElementById('logs-list');
            container.innerHTML = '';
            if (logs.length === 0) { container.innerHTML = '<div style="text-align:center; padding:40px; opacity:0.5; font-style:italic">No quantum entries recorded.</div>'; return; }
            [...logs].reverse().forEach(log => {
                const div = document.createElement('div');
                div.className = 'log-item';
                div.innerHTML = `<div class="log-details"><h4>${log.userName}</h4><p>${log.userCourse} <span style="margin:0 5px">•</span> ID: ${log.userId}</p></div><div class="log-time"><div>${new Date(log.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div><div style="font-size:0.7em; opacity:0.7">${new Date(log.timestamp).toLocaleDateString()}</div></div>`;
                container.appendChild(div);
            });
        }

        function downloadLogs() {
            if(logs.length === 0) { showToast("Log Database Empty", true); return; }
            const csvHeader = "Name,Course,Student ID,Date,Time\n";
            const csvRows = logs.map(e => `${e.userName},${e.userCourse},${e.userId},${e.dateStr}`);
            const csv = "data:text/csv;charset=utf-8," + csvHeader + csvRows.join("\n");
            const link = document.createElement("a"); link.setAttribute("href", encodeURI(csv)); link.setAttribute("download", `Fouvady_Logs_${Date.now()}.csv`); document.body.appendChild(link); link.click(); document.body.removeChild(link);
            showToast("Log Exported");
        }

        function showToast(msg, isError = false) {
            const t = document.getElementById('toast');
            const i = document.getElementById('toast-icon');
            const m = document.getElementById('toast-msg');
            m.innerText = msg; 
            
            if (isError) {
                i.innerText = '⚠'; 
                i.style.color = '#ff00cc'; // Pink/Red for error
                t.style.borderColor = '#ff00cc';
            } else {
                i.innerText = '✓'; 
                i.style.color = '#00ffaa'; // Green for success
                t.style.borderColor = '#00ffaa';
            }
            
            t.classList.add('visible');
            
            // Clear existing timeout if multiple toasts fire quickly
            if (t.timeoutId) clearTimeout(t.timeoutId);
            
            t.timeoutId = setTimeout(() => {
                t.classList.remove('visible');
            }, 3000);
        }
    </script>
</body>
</html>
